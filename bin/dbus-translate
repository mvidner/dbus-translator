#!/usr/bin/env ruby
# frozen_string_literal: true

$LOAD_PATH.unshift File.expand_path("../lib", __dir__)

require "dbus-babel"

execute = false
case ARGV.first
when "-x", "--execute"
  execute = true
  ARGV.shift
end

command = DBusBabel.parse_argv(ARGV)

if command.nil?
  warn "Unrecognized tool #{ARGV.first.inspect}"
  exit 1
end

[DBusBabel::DBusSend, DBusBabel::Busctl, DBusBabel::GDBus].each do |klass|
  shell_command = klass.new(command).to_s
  puts shell_command
  system shell_command if execute
end
